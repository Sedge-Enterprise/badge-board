<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Skunkworks LearnSync Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { background:#0a0f14; color:#e5eef5; font-family:Inter,Arial,sans-serif; margin:0; }
  header { background:#0d1b26; padding:20px; border-bottom:1px solid #14212e; }
  h1 { margin:0; font-size:22px; }
  main { padding:20px; max-width:1200px; margin:auto; }
  .card { background:#0d1b26; border:1px solid #14212e; border-radius:10px; padding:20px; margin-bottom:24px; }
  select, button { background:#0a0f14; color:#e5eef5; border:1px solid #14212e; border-radius:8px; padding:8px 12px; }
  button { background:#1365f4; border:none; cursor:pointer; font-weight:600; }
  button:hover { background:#1a7bff; }
  .charts { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th,td { border-bottom:1px solid #14212e; padding:8px 10px; font-size:14px; text-align:left; }
  .profile-links a { color:#8ecae6; text-decoration:none; margin-right:15px; }
  .small { color:#8ba0b8; font-size:13px; }
</style>
</head>
<body>
<header><h1>Skunkworks LearnSync Dashboard</h1></header>
<main>
  <div class="card">
    <label for="intern">Select Intern:</label>
    <select id="intern">
      <option value="hamzah-mahomed">Hamzah Mohamed</option>
      <option value="khutjo-satekge">Khutjo Satekge</option>
      <option value="nokuthulamangweni">Nokuthula Mangweni</option>
    </select>
    <button id="load">Load Progress</button>
    <p class="small">Displays Microsoft Learn and Credly progress for the selected intern.</p>
  </div>
  <div id="profile"></div>
  <div id="metrics"></div>
  <div id="charts"></div>
</main>

<script>
const profiles={
  "hamzah-mahomed":{
    learn:"https://learn.microsoft.com/en-us/users/hamzah-mahomed/",
    credly:"https://www.credly.com/users/hamzah-mahomet/badges"
  },
  "khutjo-satekge":{
    learn:"https://learn.microsoft.com/en-us/users/Khutjo-Satekge/",
    credly:"https://www.credly.com/users/khutjo-satekge/badges"
  },
  "nokuthulamangweni":{
    learn:"https://learn.microsoft.com/en-us/users/nokuthulamangweni/",
    credly:"https://www.credly.com/users/nokuthula-mangweni/badges"
  }
};

async function fetchCredly(username){
  const resp=await fetch(`https://www.credly.com/api/v1/users/${username}/badges`);
  if(!resp.ok) return [];
  const json=await resp.json();
  return json.data.map(b=>({
    name:b.attributes.name,
    date:b.attributes.issued_at,
    issuer:b.attributes.issuer.name
  }));
}

async function fetchLearn(username){
  const resp=await fetch(`https://learn.microsoft.com/api/learn/users/${username}`);
  if(!resp.ok) return [];
  const json=await resp.json();
  if(!json.achievements) return [];
  return json.achievements.map(a=>({
    name:a.title || a.name,
    date:a.completedDate,
    issuer:"Microsoft"
  }));
}

document.getElementById("load").onclick=async()=>{
  const user=document.getElementById("intern").value;
  const info=profiles[user];
  document.getElementById("profile").innerHTML=
    `<div class='card'><h2>${user.replace(/-/g,' ')}</h2>
      <div class='profile-links'>
        <a href='${info.learn}' target='_blank'>Microsoft Learn Profile</a>
        <a href='${info.credly}' target='_blank'>Credly Profile</a>
      </div></div>`;
  
  const [credly,learn]=await Promise.all([fetchCredly(user),fetchLearn(user)]);
  const total=credly.length+learn.length;
  const skillIndex=(credly.length*1.2 + learn.length)/2; // illustrative
  const progressStage=total<5?"Explorer":total<15?"Builder":"Integrator";

  document.getElementById("metrics").innerHTML=`
    <div class='card'>
      <h3>Performance Summary</h3>
      <table>
        <tr><th>Metric</th><th>Score / Count</th></tr>
        <tr><td>Total Badges</td><td>${credly.length}</td></tr>
        <tr><td>Learn Modules Completed</td><td>${learn.length}</td></tr>
        <tr><td>Skill Mastery Index</td><td>${skillIndex.toFixed(2)}</td></tr>
        <tr><td>Progress Stage</td><td>${progressStage}</td></tr>
      </table>
    </div>
  `;

  const ctx1=document.createElement("canvas");
  const ctx2=document.createElement("canvas");
  document.getElementById("charts").innerHTML="<div class='card charts'></div>";
  document.querySelector(".charts").append(ctx1,ctx2);

  const all=[...credly.map(i=>({x:new Date(i.date),y:1})),
             ...learn.map(i=>({x:new Date(i.date),y:1}))].sort((a,b)=>a.x-b.x);
  let cumulative=[];let c=0;for(const a of all){c++;cumulative.push({x:a.x,y:c});}

  new Chart(ctx1,{type:"line",
    data:{datasets:[{label:"Cumulative Achievements",data:cumulative,
      borderColor:"#1a7bff",backgroundColor:"rgba(26,123,255,0.3)",fill:true}]},
    options:{scales:{x:{type:"time",time:{unit:"month"},ticks:{color:"#8ba0b8"}},
      y:{ticks:{color:"#8ba0b8"}}},plugins:{legend:{labels:{color:"#e5eef5"}}}}});

  const issuers={};
  credly.forEach(i=>issuers[i.issuer]=(issuers[i.issuer]||0)+1);
  learn.forEach(i=>issuers[i.issuer]=(issuers[i.issuer]||0)+1);

  new Chart(ctx2,{type:"pie",
    data:{labels:Object.keys(issuers),
      datasets:[{data:Object.values(issuers),
      backgroundColor:["#2a9d8f","#e76f51","#8ecae6","#f4a261"]}]},
    options:{plugins:{legend:{labels:{color:"#e5eef5"}}}}});
};
</script>
</body>
</html>
